<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha de Sobreviv√™ncia - RPG D6</title>
  <style>
    :root {
      --dark-bg: #1e1e1e;
      --card-bg: #2a2a2a;
      --text-color: #e0e0e0;
      --primary-color: #8b4513;
      --secondary-color: #a0522d;
      --accent-color: #cd853f;
      --healthy-color: #4caf50;
      --hurt-color: #ff9800;
      --dead-color: #f44336;
      --hunger-color: #795548;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--dark-bg);
      color: var(--text-color);
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    h1, h2, h3 {
      color: var(--accent-color);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
    }
    
    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      border-left: 4px solid var(--primary-color);
    }
    
    /* Se√ß√£o de Retrato Aprimorada */
    .portrait-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .portrait-container {
      position: relative;
      width: 150px;
      height: 150px;
      border: 3px solid var(--primary-color);
      border-radius: 5px;
      overflow: hidden;
    }
    
    .portrait {
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      transition: opacity 0.5s ease-in-out;
    }
    
    .portrait.portrait-healthy {
      background-image: url('https://via.placeholder.com/150/4caf50/ffffff?text=Saud√°vel');
    }
    
    .portrait.portrait-hurt {
      background-image: url('https://via.placeholder.com/150/ff9800/ffffff?text=Machucado');
    }
    
    .portrait.portrait-dead {
      background-image: url('https://via.placeholder.com/150/f44336/ffffff?text=Morto');
      filter: brightness(0.5);
    }
    
    .portrait.fade-out {
      opacity: 0;
    }
    
    .portrait.fade-in {
      opacity: 1;
    }
    
    .portrait-controls {
      display: flex;
      gap: 10px;
    }
    
    .portrait-selector {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }
    
    .portrait-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
      background-color: rgba(0,0,0,0.2);
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .portrait-option:hover {
      background-color: rgba(0,0,0,0.4);
    }
    
    .portrait-option.active {
      background-color: var(--primary-color);
    }
    
    .portrait-preview {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      background-size: cover;
      background-position: center;
    }
    
    .upload-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .upload-btn:hover {
      background-color: var(--secondary-color);
    }
    
    /* Barras de status com efeito l√≠quido */
    .stat-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .stat-bar-container {
      flex: 1;
      position: relative;
    }
    
    .stat-bar {
      height: 25px;
      background-color: #333;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }
    
    .stat-fill {
      height: 100%;
      transition: width 0.5s ease-in-out;
      position: relative;
      overflow: hidden;
    }
    
    /* Efeito l√≠quido nas barras */
    .stat-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(255, 255, 255, 0.2) 50%,
        transparent 100%
      );
      animation: liquidEffect 3s infinite linear;
      border-radius: 10px;
    }
    
    @keyframes liquidEffect {
      0% {
        transform: translateY(-100%);
      }
      100% {
        transform: translateY(100%);
      }
    }
    
    .hp-fill {
      background-color: var(--healthy-color);
    }
    
    .effort-fill {
      background-color: var(--secondary-color);
    }
    
    .sacrifice-fill {
      background-color: var(--accent-color);
    }
    
    .hunger-fill {
      background-color: var(--hunger-color);
    }
    
    .stat-value {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
      z-index: 2;
    }
    
    .stat-input {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .stat-input input {
      width: 50px;
      text-align: center;
      font-weight: bold;
    }
    
    .btn-control {
      background-color: var(--primary-color);
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
    }
    
    .btn-control:hover {
      background-color: var(--secondary-color);
    }
    
    /* Restante do CSS */
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--accent-color);
    }
    
    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #444;
      border-radius: 4px;
      box-sizing: border-box;
      background-color: #333;
      color: var(--text-color);
    }
    
    .attributes-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    
    .attribute-box {
      background-color: rgba(0,0,0,0.2);
      border-radius: 5px;
      padding: 10px;
      text-align: center;
    }
    
    .attribute-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .attribute-value {
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .skills-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .skill-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .skill-item input {
      width: 50px;
      text-align: center;
    }
    
    .inventory-item {
      display: flex;
      margin-bottom: 5px;
    }
    
    .inventory-item input {
      flex: 1;
      margin-right: 10px;
    }
    
    .debilities-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .debilities-table th, .debilities-table td {
      border: 1px solid #444;
      padding: 8px;
      text-align: left;
    }
    
    .debilities-table th {
      background-color: var(--primary-color);
      color: white;
    }
    
    .dice-roller {
      background-color: var(--primary-color);
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      text-align: center;
    }
    
    .dice-result {
      font-size: 1.5em;
      font-weight: bold;
      margin: 10px 0;
      min-height: 1.5em;
    }
    
    .success-fail {
      font-weight: bold;
      margin-top: 5px;
    }
    
    .success {
      color: var(--healthy-color);
    }
    
    .fail {
      color: var(--dead-color);
    }
    
    .neutral {
      color: var(--accent-color);
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      flex: 1;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: background 0.3s;
    }
    
    button:hover {
      background-color: var(--secondary-color);
    }
    
    /* Modal de Sele√ß√£o de Imagens */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: 5px;
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.5em;
      cursor: pointer;
    }
    
    .image-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .image-option {
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .image-option:hover {
      transform: scale(1.05);
      border-color: var(--accent-color);
    }
    
    .image-option.selected {
      border-color: var(--healthy-color);
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }
    
    .image-option img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 3px;
    }
    
    @media (max-width: 768px) {
      .grid-container {
        grid-template-columns: 1fr;
      }
      
      .image-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>

  <h1>Ficha de Sobreviv√™ncia - RPG D6</h1>
  
  <div class="grid-container">
    <!-- Se√ß√£o de Valores Gerais -->
    <div class="card">
      <h2>Informa√ß√µes Gerais</h2>
      
      <div class="portrait-section">
        <div class="portrait-container">
          <div class="portrait portrait-healthy fade-in" id="character-portrait"></div>
        </div>
        
        <div class="portrait-controls">
          <button class="upload-btn" onclick="openImageModal()">
            <span>üñºÔ∏è</span> Escolher Imagens
          </button>
          <input type="file" id="portrait-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
          <button class="upload-btn" onclick="document.getElementById('portrait-upload').click()">
            <span>üì§</span> Enviar Imagem
          </button>
        </div>
        
        <div class="portrait-selector">
          <div class="portrait-option active" onclick="changePortraitState('healthy')">
            <div class="portrait-preview portrait-healthy"></div>
            <span>Est√°vel</span>
          </div>
          <div class="portrait-option" onclick="changePortraitState('hurt')">
            <div class="portrait-preview portrait-hurt"></div>
            <span>Machucado</span>
          </div>
          <div class="portrait-option" onclick="changePortraitState('dead')">
            <div class="portrait-preview portrait-dead"></div>
            <span>Morto</span>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="nome">Nome do Personagem</label>
        <input type="text" id="nome">
      </div>
      
      <div class="form-group">
        <label for="ocupacao">Ocupa√ß√£o</label>
        <input type="text" id="ocupacao">
      </div>
      
      <div class="form-group">
        <label>Pontos de Vida (PV)</label>
        <div class="stat-control">
          <button class="btn-control" onclick="changeStat('hp', -1)">-</button>
          <div class="stat-bar-container">
            <div class="stat-bar">
              <div class="stat-fill hp-fill" id="hp-fill" style="width: 100%"></div>
              <div class="stat-value" id="hp-value">10</div>
            </div>
          </div>
          <button class="btn-control" onclick="changeStat('hp', 1)">+</button>
          <div class="stat-input">
            <input type="number" id="hp" min="0" max="10" value="10" onchange="updateHP()">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>Pontos de Empenho</label>
        <div class="stat-control">
          <button class="btn-control" onclick="changeStat('empenho', -1)">-</button>
          <div class="stat-bar-container">
            <div class="stat-bar">
              <div class="stat-fill effort-fill" id="effort-fill" style="width: 100%"></div>
              <div class="stat-value" id="effort-value">5</div>
            </div>
          </div>
          <button class="btn-control" onclick="changeStat('empenho', 1)">+</button>
          <div class="stat-input">
            <input type="number" id="empenho" min="0" max="5" value="5" onchange="updateEffort()">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>Pontos de A√ß√£o Sacrificial</label>
        <div class="stat-control">
          <button class="btn-control" onclick="changeStat('sacrificio', -1)">-</button>
          <div class="stat-bar-container">
            <div class="stat-bar">
              <div class="stat-fill sacrifice-fill" id="sacrifice-fill" style="width: 100%"></div>
              <div class="stat-value" id="sacrifice-value">3</div>
            </div>
          </div>
          <button class="btn-control" onclick="changeStat('sacrificio', 1)">+</button>
          <div class="stat-input">
            <input type="number" id="sacrificio" min="0" max="3" value="3" onchange="updateSacrifice()">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>Pontos de Fome (Max: <span id="max-hunger">5</span>)</label>
        <div class="stat-control">
          <button class="btn-control" onclick="changeStat('fome', -1)">-</button>
          <div class="stat-bar-container">
            <div class="stat-bar">
              <div class="stat-fill hunger-fill" id="hunger-fill" style="width: 0%"></div>
              <div class="stat-value" id="hunger-value">0</div>
            </div>
          </div>
          <button class="btn-control" onclick="changeStat('fome', 1)">+</button>
          <div class="stat-input">
            <input type="number" id="fome" min="0" max="5" value="0" onchange="updateHunger()">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>Defesa: <span id="defesa-value">2</span></label>
      </div>
      
      <div class="form-group">
        <label>Esquiva: <span id="esquiva-value">2</span></label>
      </div>
      
      <div class="form-group">
        <label>Estado: <span id="estado-value" class="healthy">Est√°vel</span></label>
      </div>
    </div>
    
    <!-- Se√ß√£o de Atributos -->
    <div class="card">
      <h2>Atributos</h2>
      
      <div class="attributes-grid">
        <div class="attribute-box">
          <div class="attribute-title">For√ßa</div>
          <input type="number" class="attribute-value" id="forca" min="1" max="6" value="2" onchange="updateAttributes()">
        </div>
        
        <div class="attribute-box">
          <div class="attribute-title">Destreza</div>
          <input type="number" class="attribute-value" id="destreza" min="1" max="6" value="2" onchange="updateAttributes()">
        </div>
        
        <div class="attribute-box">
          <div class="attribute-title">Intelig√™ncia</div>
          <input type="number" class="attribute-value" id="inteligencia" min="1" max="6" value="2" onchange="updateAttributes()">
        </div>
        
        <div class="attribute-box">
          <div class="attribute-title">Vigor</div>
          <input type="number" class="attribute-value" id="vigor" min="1" max="6" value="2" onchange="updateAttributes()">
        </div>
      </div>
      
      <h3>Per√≠cias</h3>
      <div class="skills-grid">
        <div class="skill-item">
          <span>Medicina</span>
          <input type="number" id="medicina" min="0" max="6" value="0">
        </div>
        <div class="skill-item">
          <span>Combate</span>
          <input type="number" id="combate" min="0" max="6" value="0">
        </div>
        <div class="skill-item">
          <span>Cozinhar</span>
          <input type="number" id="cozinhar" min="0" max="6" value="0">
        </div>
        <div class="skill-item">
          <span>Inventar</span>
          <input type="number" id="inventar" min="0" max="6" value="0">
        </div>
        <div class="skill-item">
          <span>Persuadir</span>
          <input type="number" id="persuadir" min="0" max="6" value="0">
        </div>
        <div class="skill-item">
          <span>Pilotar</span>
          <input type="number" id="pilotar" min="0" max="6" value="0">
        </div>
      </div>
    </div>
    
    <!-- Se√ß√£o de Equipamentos -->
    <div class="card">
      <h2>Equipamentos</h2>
      <div id="equipamentos-container">
        <div class="inventory-item">
          <input type="text" placeholder="Item">
          <input type="text" placeholder="Detalhes" style="flex: 2;">
        </div>
      </div>
      <button onclick="addEquipment()" style="margin-top: 10px;">+ Adicionar Item</button>
    </div>
    
    <!-- Se√ß√£o de Debilita√ß√µes -->
    <div class="card">
      <h2>Debilita√ß√µes</h2>
      <table class="debilities-table">
        <thead>
          <tr>
            <th>Debilidade</th>
            <th>Efeito</th>
            <th>Ativo</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Fome Extrema</td>
            <td>-1 em todos os testes</td>
            <td><input type="checkbox" id="deb-fome"></td>
          </tr>
          <tr>
            <td>Ferido Grave</td>
            <td>-2 em testes f√≠sicos</td>
            <td><input type="checkbox" id="deb-ferido"></td>
          </tr>
          <tr>
            <td>Exausto</td>
            <td>-1 em Vigor e Destreza</td>
            <td><input type="checkbox" id="deb-exausto"></td>
          </tr>
          <tr>
            <td>Doente</td>
            <td>Perde 1 PV por dia</td>
            <td><input type="checkbox" id="deb-doente"></td>
          </tr>
          <tr>
            <td>Traumatizado</td>
            <td>-1 em Presen√ßa e Intelig√™ncia</td>
            <td><input type="checkbox" id="deb-trauma"></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Se√ß√£o de Anota√ß√µes -->
    <div class="card">
      <h2>Hist√≥ria e Anota√ß√µes</h2>
      <textarea id="anotacoes" style="width: 100%; height: 200px; padding: 8px;"></textarea>
    </div>
    
    <!-- Rolador de Dados -->
    <div class="card dice-roller">
      <h2>Rolagem de Dados (D6)</h2>
      <button onclick="rollDice()">Rolar Dado</button>
      <div class="dice-result" id="dice-result"></div>
      <div class="success-fail" id="success-fail"></div>
    </div>
  </div>
  
  <div class="button-group">
    <button onclick="saveCharacter()">Salvar Personagem</button>
    <button onclick="loadCharacter()">Carregar Personagem</button>
    <button onclick="resetCharacter()">Novo Personagem</button>
  </div>

  <!-- Modal de Sele√ß√£o de Imagens -->
  <div class="modal" id="image-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Selecionar Imagens para Estados</h2>
        <button class="modal-close" onclick="closeImageModal()">&times;</button>
      </div>
      
      <div class="portrait-selector" style="margin-bottom: 15px;">
        <div class="portrait-option active" onclick="changePortraitTab('healthy')">
          <div class="portrait-preview portrait-healthy"></div>
          <span>Est√°vel</span>
        </div>
        <div class="portrait-option" onclick="changePortraitTab('hurt')">
          <div class="portrait-preview portrait-hurt"></div>
          <span>Machucado</span>
        </div>
        <div class="portrait-option" onclick="changePortraitTab('dead')">
          <div class="portrait-preview portrait-dead"></div>
          <span>Morto</span>
        </div>
      </div>
      
      <h3 id="modal-state-title">Imagens para Estado Est√°vel</h3>
      
      <div class="image-grid" id="image-grid">
        <!-- Imagens ser√£o carregadas aqui -->
      </div>
      
      <div style="margin-top: 15px;">
        <button onclick="confirmImageSelection()">Confirmar Sele√ß√£o</button>
      </div>
    </div>
  </div>

  <script>
    // Vari√°veis globais
    let maxHP = 10;
    let maxHunger = 5;
    let currentPortraitState = 'healthy';
    let selectedImages = {
      healthy: null,
      hurt: null,
      dead: null
    };
    let currentImageTab = 'healthy';
    
    // Banco de imagens padr√£o
    const defaultImages = {
      healthy: [
        'https://via.placeholder.com/150/4caf50/ffffff?text=Saud√°vel+1',
        'https://via.placeholder.com/150/4caf50/ffffff?text=Saud√°vel+2',
        'https://via.placeholder.com/150/4caf50/ffffff?text=Saud√°vel+3'
      ],
      hurt: [
        'https://via.placeholder.com/150/ff9800/ffffff?text=Machucado+1',
        'https://via.placeholder.com/150/ff9800/ffffff?text=Machucado+2',
        'https://via.placeholder.com/150/ff9800/ffffff?text=Machucado+3'
      ],
      dead: [
        'https://via.placeholder.com/150/f44336/ffffff?text=Morto+1',
        'https://via.placeholder.com/150/f44336/ffffff?text=Morto+2',
        'https://via.placeholder.com/150/f44336/ffffff?text=Morto+3'
      ]
    };
    
    // Inicializa√ß√£o
    window.onload = function() {
      updateHP();
      updateEffort();
      updateSacrifice();
      updateHunger();
      updateAttributes();
      addEquipment();
      
      // Configurar upload de imagem
      document.getElementById('portrait-upload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            // Atualiza a imagem para o estado atual
            updatePortraitImage(event.target.result);
            
            // Adiciona ao banco de imagens para o estado atual
            selectedImages[currentPortraitState] = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    };
    
    // Fun√ß√µes para controle de estat√≠sticas
    function changeStat(stat, value) {
      const input = document.getElementById(stat);
      let currentValue = parseInt(input.value) || 0;
      currentValue += value;
      
      // Garantir que n√£o passe dos limites
      if (currentValue < 0) currentValue = 0;
      if (stat === 'hp' && currentValue > maxHP) currentValue = maxHP;
      if (stat === 'empenho' && currentValue > 5) currentValue = 5;
      if (stat === 'sacrificio' && currentValue > 3) currentValue = 3;
      if (stat === 'fome' && currentValue > maxHunger) currentValue = maxHunger;
      
      input.value = currentValue;
      
      // Atualizar a estat√≠stica correspondente
      if (stat === 'hp') updateHP();
      else if (stat === 'empenho') updateEffort();
      else if (stat === 'sacrificio') updateSacrifice();
      else if (stat === 'fome') updateHunger();
    }
    
    // Atualiza a barra de HP e estado
    function updateHP() {
      const hpInput = document.getElementById('hp');
      let hp = parseInt(hpInput.value);
      const vigor = parseInt(document.getElementById('vigor').value);
      
      // Calcular HP m√°ximo baseado no vigor
      maxHP = 5 + vigor;
      hpInput.max = maxHP;
      
      // Garantir que HP n√£o seja negativo
      if (hp < 0) {
        hp = 0;
        hpInput.value = 0;
      } else if (hp > maxHP) {
        hp = maxHP;
        hpInput.value = maxHP;
      }
      
      // Atualizar barra de HP
      const percent = (hp / maxHP) * 100;
      document.getElementById('hp-fill').style.width = `${percent}%`;
      document.getElementById('hp-value').textContent = hp;
      
      // Atualizar estado
      updatePortraitState(hp);
      
      // Atualizar fome m√°xima (metade do HP m√°ximo)
      maxHunger = Math.floor(maxHP / 2);
      document.getElementById('max-hunger').textContent = maxHunger;
      document.getElementById('fome').max = maxHunger;
      
      // Ajustar fome se necess√°rio
      const currentHunger = parseInt(document.getElementById('fome').value);
      if (currentHunger > maxHunger) {
        document.getElementById('fome').value = maxHunger;
        updateHunger();
      }
    }
    
    // Atualiza o retrato baseado no estado de HP
    function updatePortraitState(hp) {
      const portrait = document.getElementById('character-portrait');
      const estadoElement = document.getElementById('estado-value');
      
      // Determinar novo estado
      let newState = 'healthy';
      if (hp === 0) {
        newState = 'dead';
      } else if (hp <= maxHP / 2) {
        newState = 'hurt';
      }
      
      // Atualizar apenas se o estado mudou
      if (newState !== currentPortraitState) {
        // Aplicar efeito de fade out
        portrait.classList.add('fade-out');
        
        // Esperar a transi√ß√£o de fade out terminar antes de mudar o estado
        setTimeout(() => {
          currentPortraitState = newState;
          
          // Atualizar classes do retrato
          portrait.classList.remove('portrait-healthy', 'portrait-hurt', 'portrait-dead');
          portrait.classList.add(`portrait-${newState}`);
          
          // Carregar imagem selecionada para o novo estado, se existir
          if (selectedImages[newState]) {
            portrait.style.backgroundImage = `url(${selectedImages[newState]})`;
          } else {
            // Se n√£o houver imagem personalizada, usar a padr√£o
            portrait.style.backgroundImage = '';
          }
          
          // Aplicar efeito de fade in
          portrait.classList.remove('fade-out');
          portrait.classList.add('fade-in');
          
          // Atualizar texto do estado
          estadoElement.className = '';
          estadoElement.classList.add(newState);
          
          if (newState === 'healthy') {
            estadoElement.textContent = "Est√°vel";
          } else if (newState === 'hurt') {
            estadoElement.textContent = "Machucado";
          } else {
            estadoElement.textContent = "Morto";
          }
          
          // Ativar a op√ß√£o correspondente no seletor
          document.querySelectorAll('.portrait-option').forEach(option => {
            option.classList.remove('active');
          });
          document.querySelector(`.portrait-option:nth-child(${newState === 'healthy' ? 1 : newState === 'hurt' ? 2 : 3})`).classList.add('active');
        }, 500); // Tempo correspondente √† dura√ß√£o da transi√ß√£o
      }
    }
    
    // Muda o estado do retrato manualmente
    function changePortraitState(state) {
      const portrait = document.getElementById('character-portrait');
      
      // Aplicar efeito de fade out
      portrait.classList.add('fade-out');
      
      // Esperar a transi√ß√£o de fade out terminar antes de mudar o estado
      setTimeout(() => {
        // Ativar a op√ß√£o selecionada
        document.querySelectorAll('.portrait-option').forEach(option => {
          option.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        
        // Atualizar o estado atual
        currentPortraitState = state;
        
        // Atualizar o retrato
        portrait.classList.remove('portrait-healthy', 'portrait-hurt', 'portrait-dead');
        portrait.classList.add(`portrait-${state}`);
        
        // Carregar imagem selecionada para o estado, se existir
        if (selectedImages[state]) {
          portrait.style.backgroundImage = `url(${selectedImages[state]})`;
        } else {
          // Se n√£o houver imagem personalizada, usar a padr√£o
          portrait.style.backgroundImage = '';
        }
        
        // Aplicar efeito de fade in
        portrait.classList.remove('fade-out');
        portrait.classList.add('fade-in');
      }, 500); // Tempo correspondente √† dura√ß√£o da transi√ß√£o
    }
    
    // Atualiza a imagem do retrato
    function updatePortraitImage(imageSrc) {
      const portrait = document.getElementById('character-portrait');
      
      // Aplicar efeito de fade out
      portrait.classList.add('fade-out');
      
      // Esperar a transi√ß√£o de fade out terminar antes de mudar a imagem
      setTimeout(() => {
        portrait.style.backgroundImage = `url(${imageSrc})`;
        
        // Aplicar efeito de fade in
        portrait.classList.remove('fade-out');
        portrait.classList.add('fade-in');
      }, 500); // Tempo correspondente √† dura√ß√£o da transi√ß√£o
    }
    
    // Abre o modal de sele√ß√£o de imagens
    function openImageModal() {
      document.getElementById('image-modal').style.display = 'flex';
      loadImagesForState(currentImageTab);
    }
    
    // Fecha o modal de sele√ß√£o de imagens
    function closeImageModal() {
      document.getElementById('image-modal').style.display = 'none';
    }
    
    // Muda a aba no modal de sele√ß√£o de imagens
    function changePortraitTab(state) {
      currentImageTab = state;
      
      // Ativar a op√ß√£o selecionada
      document.querySelectorAll('#image-modal .portrait-option').forEach(option => {
        option.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      // Atualizar t√≠tulo
      document.getElementById('modal-state-title').textContent = 
        `Imagens para Estado ${state === 'healthy' ? 'Est√°vel' : state === 'hurt' ? 'Machucado' : 'Morto'}`;
      
      // Carregar imagens
      loadImagesForState(state);
    }
    
    // Carrega imagens para um estado espec√≠fico
    function loadImagesForState(state) {
      const imageGrid = document.getElementById('image-grid');
      imageGrid.innerHTML = '';
      
      // Carregar imagens padr√£o
      defaultImages[state].forEach((img, index) => {
        const imgElement = document.createElement('div');
        imgElement.className = 'image-option';
        if (selectedImages[state] === img) {
          imgElement.classList.add('selected');
        }
        imgElement.innerHTML = `<img src="${img}" alt="Op√ß√£o ${index + 1}">`;
        imgElement.onclick = function() {
          selectImage(img, state);
        };
        imageGrid.appendChild(imgElement);
      });
      
      // Carregar imagens personalizadas se existirem
      if (selectedImages[state] && !defaultImages[state].includes(selectedImages[state])) {
        const imgElement = document.createElement('div');
        imgElement.className = 'image-option';
        if (selectedImages[state]) {
          imgElement.classList.add('selected');
        }
        imgElement.innerHTML = `<img src="${selectedImages[state]}" alt="Imagem Personalizada">`;
        imgElement.onclick = function() {
          selectImage(selectedImages[state], state);
        };
        imageGrid.appendChild(imgElement);
      }
    }
    
    // Seleciona uma imagem para um estado
    function selectImage(imgSrc, state) {
      // Remover sele√ß√£o anterior
      document.querySelectorAll('#image-grid .image-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      // Marcar como selecionada
      event.currentTarget.classList.add('selected');
      
      // Atualizar imagem selecionada
      selectedImages[state] = imgSrc;
    }
    
    // Confirma a sele√ß√£o de imagens
    function confirmImageSelection() {
      // Atualizar o retrato se estivermos visualizando o estado selecionado
      if (selectedImages[currentPortraitState]) {
        updatePortraitImage(selectedImages[currentPortraitState]);
      }
      closeImageModal();
    }
    
    // Fun√ß√£o para lidar com upload de imagem
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          updatePortraitImage(e.target.result);
          selectedImages[currentPortraitState] = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }
    
    function updateEffort() {
      const empenho = parseInt(document.getElementById('empenho').value);
      const maxEmpenho = 5;
      
      if (empenho > maxEmpenho) {
        document.getElementById('empenho').value = maxEmpenho;
        return updateEffort();
      }
      
      if (empenho < 0) {
        document.getElementById('empenho').value = 0;
        return updateEffort();
      }
      
      const percent = (empenho / maxEmpenho) * 100;
      document.getElementById('effort-fill').style.width = `${percent}%`;
      document.getElementById('effort-value').textContent = empenho;
    }
    
    function updateSacrifice() {
      const sacrificio = parseInt(document.getElementById('sacrificio').value);
      const maxSacrificio = 3;
      
      if (sacrificio > maxSacrificio) {
        document.getElementById('sacrificio').value = maxSacrificio;
        return updateSacrifice();
      }
      
      if (sacrificio < 0) {
        document.getElementById('sacrificio').value = 0;
        return updateSacrifice();
      }
      
      const percent = (sacrificio / maxSacrificio) * 100;
      document.getElementById('sacrifice-fill').style.width = `${percent}%`;
      document.getElementById('sacrifice-value').textContent = sacrificio;
    }
    
    function updateHunger() {
      const fome = parseInt(document.getElementById('fome').value);
      
      if (fome > maxHunger) {
        document.getElementById('fome').value = maxHunger;
        return updateHunger();
      }
      
      if (fome < 0) {
        document.getElementById('fome').value = 0;
        return updateHunger();
      }
      
      const percent = (fome / maxHunger) * 100;
      document.getElementById('hunger-fill').style.width = `${percent}%`;
      document.getElementById('hunger-value').textContent = fome;
    }
    
    function updateAttributes() {
      const forca = parseInt(document.getElementById('forca').value);
      const destreza = parseInt(document.getElementById('destreza').value);
      const vigor = parseInt(document.getElementById('vigor').value);
      
      document.getElementById('defesa-value').textContent = forca;
      document.getElementById('esquiva-value').textContent = destreza;
      updateHP();
    }
    
    function addEquipment() {
      const container = document.getElementById('equipamentos-container');
      const newItem = document.createElement('div');
      newItem.className = 'inventory-item';
      newItem.innerHTML = `
        <input type="text" placeholder="Item">
        <input type="text" placeholder="Detalhes" style="flex: 2;">
      `;
      container.appendChild(newItem);
    }
    
    function rollDice() {
      const result = Math.floor(Math.random() * 6) + 1;
      const resultElement = document.getElementById('dice-result');
      const successElement = document.getElementById('success-fail');
      
      resultElement.textContent = `Resultado: ${result}`;
      
      if (result <= 2) {
        successElement.textContent = "Falha!";
        successElement.className = "success-fail fail";
      } else if (result <= 4) {
        successElement.textContent = "Neutro";
        successElement.className = "success-fail neutral";
      } else {
        successElement.textContent = "Sucesso!";
        successElement.className = "success-fail success";
      }
    }
    
    function saveCharacter() {
      const character = {
        basicInfo: {
          nome: document.getElementById('nome').value,
          ocupacao: document.getElementById('ocupacao').value,
          portraitImages: selectedImages
        },
        stats: {
          hp: document.getElementById('hp').value,
          empenho: document.getElementById('empenho').value,
          sacrificio: document.getElementById('sacrificio').value,
          fome: document.getElementById('fome').value
        },
        attributes: {
          forca: document.getElementById('forca').value,
          destreza: document.getElementById('destreza').value,
          inteligencia: document.getElementById('inteligencia').value,
          vigor: document.getElementById('vigor').value
        },
        skills: {
          medicina: document.getElementById('medicina').value,
          combate: document.getElementById('combate').value,
          cozinhar: document.getElementById('cozinhar').value,
          inventar: document.getElementById('inventar').value,
          persuadir: document.getElementById('persuadir').value,
          pilotar: document.getElementById('pilotar').value
        },
        debilities: {
          fome: document.getElementById('deb-fome').checked,
          ferido: document.getElementById('deb-ferido').checked,
          exausto: document.getElementById('deb-exausto').checked,
          doente: document.getElementById('deb-doente').checked,
          trauma: document.getElementById('deb-trauma').checked
        },
        notes: document.getElementById('anotacoes').value
      };
      
      const equipmentItems = document.querySelectorAll('#equipamentos-container .inventory-item');
      character.equipment = [];
      equipmentItems.forEach(item => {
        const inputs = item.querySelectorAll('input');
        if (inputs[0].value) {
          character.equipment.push({
            name: inputs[0].value,
            details: inputs[1].value
          });
        }
      });
      
      localStorage.setItem('survivalCharacter', JSON.stringify(character));
      alert('Personagem salvo com sucesso!');
    }
    
    function loadCharacter() {
      const savedCharacter = localStorage.getItem('survivalCharacter');
      if (!savedCharacter) {
        alert('Nenhum personagem salvo encontrado.');
        return;
      }
      
      const character = JSON.parse(savedCharacter);
      
      document.getElementById('nome').value = character.basicInfo.nome || '';
      document.getElementById('ocupacao').value = character.basicInfo.ocupacao || '';
      
      // Carregar imagens do retrato
      if (character.basicInfo.portraitImages) {
        selectedImages = character.basicInfo.portraitImages;
        
        // Atualizar retrato com a imagem do estado atual
        if (selectedImages[currentPortraitState]) {
          updatePortraitImage(selectedImages[currentPortraitState]);
        }
      }
      
      document.getElementById('hp').value = character.stats.hp || 10;
      document.getElementById('empenho').value = character.stats.empenho || 5;
      document.getElementById('sacrificio').value = character.stats.sacrificio || 3;
      document.getElementById('fome').value = character.stats.fome || 0;
      
      document.getElementById('forca').value = character.attributes.forca || 2;
      document.getElementById('destreza').value = character.attributes.destreza || 2;
      document.getElementById('inteligencia').value = character.attributes.inteligencia || 2;
      document.getElementById('vigor').value = character.attributes.vigor || 2;
      
      document.getElementById('medicina').value = character.skills.medicina || 0;
      document.getElementById('combate').value = character.skills.combate || 0;
      document.getElementById('cozinhar').value = character.skills.cozinhar || 0;
      document.getElementById('inventar').value = character.skills.inventar || 0;
      document.getElementById('persuadir').value = character.skills.persuadir || 0;
      document.getElementById('pilotar').value = character.skills.pilotar || 0;
      
      document.getElementById('deb-fome').checked = character.debilities.fome || false;
      document.getElementById('deb-ferido').checked = character.debilities.ferido || false;
      document.getElementById('deb-exausto').checked = character.debilities.exausto || false;
      document.getElementById('deb-doente').checked = character.debilities.doente || false;
      document.getElementById('deb-trauma').checked = character.debilities.trauma || false;
      
      document.getElementById('anotacoes').value = character.notes || '';
      
      const container = document.getElementById('equipamentos-container');
      container.innerHTML = '';
      
      if (character.equipment && character.equipment.length > 0) {
        character.equipment.forEach(item => {
          const newItem = document.createElement('div');
          newItem.className = 'inventory-item';
          newItem.innerHTML = `
            <input type="text" placeholder="Item" value="${item.name}">
            <input type="text" placeholder="Detalhes" style="flex: 2;" value="${item.details || ''}">
          `;
          container.appendChild(newItem);
        });
      } else {
        addEquipment();
      }
      
      updateHP();
      updateEffort();
      updateSacrifice();
      updateHunger();
      updateAttributes();
      
      alert('Personagem carregado com sucesso!');
    }
    
    function resetCharacter() {
      if (confirm('Tem certeza que deseja criar um novo personagem? Todos os dados n√£o salvos ser√£o perdidos.')) {
        document.getElementById('nome').value = '';
        document.getElementById('ocupacao').value = '';
        document.getElementById('character-portrait').style.backgroundImage = '';
        document.getElementById('character-portrait').className = 'portrait portrait-healthy fade-in';
        
        document.getElementById('hp').value = 10;
        document.getElementById('empenho').value = 5;
        document.getElementById('sacrificio').value = 3;
        document.getElementById('fome').value = 0;
        
        document.getElementById('forca').value = 2;
        document.getElementById('destreza').value = 2;
        document.getElementById('inteligencia').value = 2;
        document.getElementById('vigor').value = 2;
        
        document.getElementById('medicina').value = 0;
        document.getElementById('combate').value = 0;
        document.getElementById('cozinhar').value = 0;
        document.getElementById('inventar').value = 0;
        document.getElementById('persuadir').value = 0;
        document.getElementById('pilotar').value = 0;
        
        document.getElementById('deb-fome').checked = false;
        document.getElementById('deb-ferido').checked = false;
        document.getElementById('deb-exausto').checked = false;
        document.getElementById('deb-doente').checked = false;
        document.getElementById('deb-trauma').checked = false;
        
        document.getElementById('anotacoes').value = '';
        
        const container = document.getElementById('equipamentos-container');
        container.innerHTML = '';
        addEquipment();
        
        // Resetar imagens selecionadas
        selectedImages = {
          healthy: null,
          hurt: null,
          dead: null
        };
        
        updateHP();
        updateEffort();
        updateSacrifice();
        updateHunger();
        updateAttributes();
      }
    }
  </script>
</body>
</html>